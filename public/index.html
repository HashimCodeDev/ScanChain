<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScanChain - Product Authenticity Verification</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bnb-yellow: #F0B90B;
            --bnb-dark: #1E1E1E;
            --bnb-light: #F8F9FA;
            --success-green: #198754;
            --danger-red: #DC3545;
        }

        body {
            background: linear-gradient(135deg, var(--bnb-dark) 0%, #2c2c2c 100%);
            color: white;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .navbar {
            background: rgba(30, 30, 30, 0.95) !important;
            backdrop-filter: blur(10px);
            border-bottom: 2px solid var(--bnb-yellow);
        }

        .navbar-brand {
            color: var(--bnb-yellow) !important;
            font-weight: bold;
            font-size: 1.5rem;
        }

        .hero-section {
            padding: 100px 0;
            text-align: center;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), 
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="a" cx="50%" cy="50%"><stop offset="0%" stop-color="%23F0B90B" stop-opacity="0.1"/><stop offset="100%" stop-color="%23000" stop-opacity="0"/></radialGradient></defs><rect width="100%" height="100%" fill="url(%23a)"/></svg>');
            background-size: cover;
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, var(--bnb-yellow), #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            color: #cccccc;
            margin-bottom: 2rem;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(240, 185, 11, 0.3);
            border-radius: 15px;
            padding: 2rem;
            margin: 1rem 0;
            transition: all 0.3s ease;
            height: 100%;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: var(--bnb-yellow);
            box-shadow: 0 10px 30px rgba(240, 185, 11, 0.3);
        }

        .feature-icon {
            font-size: 3rem;
            color: var(--bnb-yellow);
            margin-bottom: 1rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--bnb-yellow), #FFD700);
            border: none;
            color: var(--bnb-dark);
            font-weight: bold;
            padding: 12px 30px;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(240, 185, 11, 0.4);
            background: linear-gradient(45deg, #FFD700, var(--bnb-yellow));
            color: var(--bnb-dark);
        }

        .btn-outline-light {
            border: 2px solid var(--bnb-yellow);
            color: var(--bnb-yellow);
            padding: 12px 30px;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .btn-outline-light:hover {
            background: var(--bnb-yellow);
            color: var(--bnb-dark);
            transform: translateY(-2px);
        }

        .stats-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 50px 0;
            margin: 50px 0;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--bnb-yellow);
        }

        .stat-label {
            color: #cccccc;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .tech-badge {
            background: rgba(240, 185, 11, 0.2);
            color: var(--bnb-yellow);
            padding: 5px 15px;
            border-radius: 20px;
            margin: 5px;
            display: inline-block;
            font-size: 0.9rem;
        }

        .footer {
            background: var(--bnb-dark);
            padding: 30px 0;
            border-top: 1px solid rgba(240, 185, 11, 0.3);
            margin-top: 50px;
        }

        .network-status {
            background: rgba(25, 135, 84, 0.2);
            color: var(--success-green);
            padding: 10px 20px;
            border-radius: 25px;
            border: 1px solid var(--success-green);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-shield-alt me-2"></i>ScanChain
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#features">Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#technology">Technology</a>
                    </li>
                    <li class="nav-item">
                        <span class="nav-link network-status">
                            <i class="fas fa-circle me-1"></i>BSC Testnet
                        </span>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8 text-center">
                    <h1 class="hero-title">ScanChain</h1>
                    <p class="hero-subtitle">
                        Complete supply chain traceability with blockchain verification. Create batches, track suppliers, and ensure product authenticity.
                    </p>
                    <div class="d-flex justify-content-center gap-3 flex-wrap">
                        <a href="/upload" class="btn btn-primary btn-lg pulse">
                            <i class="fas fa-plus me-2"></i>Create Batch
                        </a>
                        <a href="/scan" class="btn btn-outline-light btn-lg">
                            <i class="fas fa-qrcode me-2"></i>Scan QR Code
                        </a>
                        <a href="/verify" class="btn btn-outline-light btn-lg">
                            <i class="fas fa-search me-2"></i>Verify Product
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-section">
        <div class="container">
            <div class="row">
                <div class="col-md-3 col-6">
                    <div class="stat-item">
                        <div class="stat-number" id="productCount">0</div>
                        <div class="stat-label">Products Verified</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-item">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">Secure Storage</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-item">
                        <div class="stat-number">24/7</div>
                        <div class="stat-label">Availability</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-item">
                        <div class="stat-number">SHA-256</div>
                        <div class="stat-label">Encryption</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="py-5">
        <div class="container">
            <div class="row text-center mb-5">
                <div class="col-12">
                    <h2 class="display-4 mb-3">Powerful Features</h2>
                    <p class="lead text-muted">Complete solution for product authenticity verification</p>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-4 col-md-6">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-industry"></i>
                        </div>
                        <h3>Manufacturer Portal</h3>
                        <p>Create product batches, upload certificates to BNB Greenfield, and generate QR codes for supply chain tracking.</p>
                        <a href="/upload" class="btn btn-outline-light mt-3">
                            Create Batch <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-truck"></i>
                        </div>
                        <h3>Supplier Access</h3>
                        <p>Scan QR codes to access batch information, view certificates, and get recorded in the manufacturer's dashboard.</p>
                        <a href="/scan" class="btn btn-outline-light mt-3">
                            Scan QR Code <i class="fas fa-qrcode ms-1"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6">
                    <div class="feature-card">
                        <div class="feature-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <h3>Dashboard & Analytics</h3>
                        <p>Track all your batches, monitor supplier scans, and view real-time supply chain activity in your dashboard.</p>
                        <a href="/dashboard" class="btn btn-outline-light mt-3">
                            View Dashboard <i class="fas fa-chart-line ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Technology Section -->
    <section id="technology" class="py-5" style="background: rgba(0, 0, 0, 0.3);">
        <div class="container">
            <div class="row text-center mb-5">
                <div class="col-12">
                    <h2 class="display-4 mb-3">Powered by BNB Chain</h2>
                    <p class="lead text-muted">Built on the most advanced blockchain infrastructure</p>
                </div>
            </div>
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <h3 class="mb-4">Technology Stack</h3>
                    <div class="mb-3">
                        <span class="tech-badge"><i class="fas fa-database me-1"></i>BNB Greenfield</span>
                        <span class="tech-badge"><i class="fas fa-link me-1"></i>BNB Smart Chain</span>
                        <span class="tech-badge"><i class="fas fa-lock me-1"></i>SHA-256 Hashing</span>
                    </div>
                    <div class="mb-3">
                        <span class="tech-badge"><i class="fab fa-node-js me-1"></i>Node.js</span>
                        <span class="tech-badge"><i class="fas fa-server me-1"></i>Express.js</span>
                        <span class="tech-badge"><i class="fas fa-code me-1"></i>Ethers.js</span>
                    </div>
                    <p class="text-muted">
                        ScanChain leverages the power of BNB Greenfield for decentralized file storage and BNB Smart Chain for immutable hash verification, ensuring maximum security and transparency.
                    </p>
                </div>
                <div class="col-lg-6">
                    <div class="feature-card">
                        <h4><i class="fas fa-cogs me-2"></i>How It Works</h4>
                        <ol class="text-start mt-3">
                            <li class="mb-2">Upload your product document (PDF/JSON)</li>
                            <li class="mb-2">System generates SHA-256 hash</li>
                            <li class="mb-2">File stored on BNB Greenfield</li>
                            <li class="mb-2">Hash recorded on BSC Testnet</li>
                            <li class="mb-2">QR code generated for verification</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>ScanChain</h5>
                    <p class="text-muted">Secure product authenticity verification on BNB Chain</p>
                </div>
                <div class="col-md-6 text-end">
                    <p class="text-muted mb-0">
                        Built with <i class="fas fa-heart text-danger"></i> for BNB Chain
                    </p>
                    <small class="text-muted">Contract: <span id="contractAddress">Loading...</span></small>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentUser = null;

        // Authentication check on page load
        window.addEventListener('load', async function() {
            console.log('🔍 Starting authentication check...');
            
            const token = localStorage.getItem('authToken');
            console.log('Token exists:', !!token);
            
            if (!token) {
                console.log('❌ No token found, redirecting to login');
                window.location.href = '/login';
                return;
            }

            try {
                console.log('🔗 Verifying token with server...');
                const response = await fetch('/api/auth/verify', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                console.log('📡 Server response status:', response.status);
                
                const data = await response.json();
                console.log('📄 Server response data:', data);

                if (response.ok && data.success) {
                    console.log('✅ Authentication successful');
                    currentUser = data.user;
                    
                    // Update navbar with user info
                    updateNavbar();
                    
                    console.log('🏠 User authenticated, staying on home page');
                } else {
                    console.log('❌ Authentication failed:', data.error);
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('userData');
                    window.location.href = '/login';
                    return;
                }
                
            } catch (error) {
                console.error('💥 Auth verification network error:', error);
                // Don't redirect immediately on network errors - could be temporary
                console.log('⚠️ Network error - checking if user data exists in localStorage');
                
                const userData = localStorage.getItem('userData');
                if (userData) {
                    try {
                        currentUser = JSON.parse(userData);
                        console.log('📦 Using cached user data:', currentUser.fullName);
                        updateNavbar();
                        return;
                    } catch (parseError) {
                        console.error('Invalid user data in localStorage');
                    }
                }
                
                console.log('❌ Clearing storage and redirecting to login');
                localStorage.removeItem('authToken');
                localStorage.removeItem('userData');
                window.location.href = '/login';
            }
        });

        function updateNavbar() {
            const navElement = document.querySelector('.navbar-nav');
            if (currentUser && navElement) {
                console.log('🔄 Updating navbar for user:', currentUser.fullName);
                navElement.innerHTML = `
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user me-1"></i>${currentUser.fullName || currentUser.email}
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="/dashboard">Dashboard</a></li>
                            <li><a class="dropdown-item" href="/upload">Upload</a></li>
                            <li><a class="dropdown-item" href="/scan">Scan</a></li>
                            <li><a class="dropdown-item" href="/verify">Verify</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="logout()">Logout</a></li>
                        </ul>
                    </div>
                `;
            } else {
                console.log('⚠️ Cannot update navbar - missing user or nav element');
            }
        }

        function logout() {
            console.log('🚪 Logging out user...');
            localStorage.removeItem('authToken');
            localStorage.removeItem('userData');
            console.log('🧹 Storage cleared, redirecting to login');
            window.location.href = '/login';
        }

        // Animate stats counter
        function animateCounter(element, target) {
            let current = 0;
            const increment = target / 50;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    current = target;
                    clearInterval(timer);
                }
                element.textContent = Math.floor(current);
            }, 50);
        }

        // Load app status
        async function loadAppStatus() {
            const token = localStorage.getItem('authToken');
            if (!token) return;

            try {
                const response = await fetch('/api/health', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();
                
                if (data.contract) {
                    document.getElementById('contractAddress').textContent = 
                        `${data.contract.substring(0, 6)}...${data.contract.slice(-4)}`;
                }
                
                // Animate product counter (simulated)
                const productCountElement = document.getElementById('productCount');
                animateCounter(productCountElement, Math.floor(Math.random() * 1000) + 100);
                
            } catch (error) {
                console.error('Failed to load app status:', error);
                document.getElementById('contractAddress').textContent = 'Not available';
            }
        }

        // Load status on page load
        document.addEventListener('DOMContentLoaded', loadAppStatus);

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>
